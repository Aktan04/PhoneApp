@page "/login"
@using MudBlazor
@using PhoneApp.BlazorApp.Services
@inject AuthService AuthService
@inject NavigationManager Nav

<MudContainer MaxWidth="MaxWidth.Small" Class="mt-12">
    <MudPaper Elevation="4" Class="pa-6">

        <MudText Typo="Typo.h5" GutterBottom="true">
            Login
        </MudText>

        @if (!string.IsNullOrEmpty(error))
        {
            <MudAlert Severity="Severity.Error" Class="mb-4">
                @error
            </MudAlert>
        }

        <MudTextField Label="Email"
                      @bind-Value="email"
                      Variant="Variant.Outlined"
                      FullWidth="true"
                      Class="mb-3" />

        <MudTextField Label="Password"
                      @bind-Value="password"
                      InputType="InputType.Password"
                      Variant="Variant.Outlined"
                      FullWidth="true"
                      Class="mb-4" />

        <MudButton Color="Color.Primary"
                   Variant="Variant.Filled"
                   FullWidth="true"
                   OnClick="LoginAsync">
            Login
        </MudButton>

        <MudDivider Class="my-4" />

        <MudText Typo="Typo.body2">
            No account?
            <MudLink Href="/register">Register</MudLink>
        </MudText>

    </MudPaper>
</MudContainer>

@code {
    private string error = "";
    private string email = "";
    private string password = "";

    private async Task LoginAsync()
    {
        try
        {
            error = "";
            await AuthService.LoginAsync(email, password);
            Nav.NavigateTo("/", forceLoad: true);
        }
        catch (Exception ex)
        {
            error = ex.Message;
        }
    }
}